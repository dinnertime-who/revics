name = "revix"
main = "@tanstack/react-start/server-entry"

compatibility_date = "2025-09-02"
compatibility_flags = ["nodejs_compat"]

# [Production - 기본 환경]
[vars]
ENVIRONMENT = "production"

[[d1_databases]]
binding = "DB"
database_name = "revix"
database_id = "43d067df-7269-40c0-87a9-6380acf6c33a"
migrations_dir = "drizzle/migrations"

[[r2_buckets]]
binding = "BUCKET"
bucket_name = "revix-assets"
preview_bucket_name = "revix-assets-preview"

[[vectorize]]
binding = "VECTORIZE"
index_name = "revix-index"

[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "revix-analytics"

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

[ai]
binding = "AI"

# ---------------------------------------------------------
# [ENV.PREVIEW] 프리뷰 전용 환경 (Staging)
# ---------------------------------------------------------
[env.preview]
vars = { ENVIRONMENT = "preview" }

# D1: 프리뷰용 별도 DB 연결
[[env.preview.d1_databases]]
binding = "DB"
database_name = "revix-preview"
database_id = "51249df6-6a3f-43cf-adf5-6875ef46298a"
migrations_dir = "drizzle/migrations"

# R2: 프리뷰 환경에서도 동일한 바인딩 이름을 사용하되 버킷만 교체
[[env.preview.r2_buckets]]
binding = "BUCKET"
bucket_name = "revix-assets-preview"
preview_bucket_name = "revix-assets-preview"

# Vectorize: 프리뷰 전용 인덱스
[[env.preview.vectorize]]
binding = "VECTORIZE"
index_name = "revix-index-preview"

# Analytics: 프리뷰 전용 데이터셋
[[env.preview.analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "revix-analytics-preview"

# AI: 프리뷰 전용 AI 바인딩
[env.preview.ai]
binding = "AI"